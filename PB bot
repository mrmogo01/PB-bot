import vk_api
import time
import datetime

vk_session = vk_api.VkApi(token='vk1.a.A1vau7tzc3xegqL5fU5QpR8sfkCI2lL8eri9wYrnhCNrxXbpQz1WRhMsSQTwVw-7MEZKqC6K7P46qDXxHl3h-ycndU5q1nXj16chlqFLlInvhmgKLHeUd7wCvDT6h9wziDWCXLfE5yybYMD63LmSXAQpx5b8wPBlpozDcdrCf6jdyjsvTfUH5hGy-DWAc3M2EFC6hM_zGpsdF_fKw2HSgA')
vk = vk_session.get_api()

# –°–ø–∏—Å–æ–∫ –¥–µ–∂—É—Ä–Ω—ã—Ö –∫–æ–≤–æ—Ä–∫–∏–Ω–≥–∞
duty_schedule = {
    0: { #–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫
        #"10:00-11:00": ["@aaaaalllooooo(–ê–ª–µ–Ω–∞)", "@mrmogo(–ê–Ω–¥—Ä–µ–π)"],
        #"11:00-12:00": ["@mrmogo(–ê–Ω–¥—Ä–µ–π)", "@valeronabaddon(–î–∏–º–∞ –ú)"],
        #"12:00-13:00": ["@valeronabaddon(–î–∏–º–∞ –ú)", "@elmsberry(–≠–º–º–∞)"],
        #"13:00-14:00": ["@elmsberry(–≠–º–º–∞) (–¥–æ 13:30)", "@emma_shifter(–ù–∞—Å—Ç—è)", "@lads_mart(–õ–∞–¥–∞)"],
        #"14:00-15:00": ["@emma_shifter(–ù–∞—Å—Ç—è)", "@lads_mart(–õ–∞–¥–∞)"],
        #"15:00-16:00": ["@darianokhrinaa(–î–∞—à–∞ –ù)", "@thesleepinglion(–õ–µ–≤–∞)"]
    },
    1: { # –í—Ç–æ—Ä–Ω–∏–∫
        "10:00-11:00": ["@lezidey(–ö–∏—Ä–∏–ª–ª)", "@graziazz(–î–∞—à–∞ –§)"],
        "11:00-12:00": ["@graziazz(–î–∞—à–∞ –§)", "@limonadgs(–î–∏–º–∞ –Æ)"],
        "12:00-13:00": ["@limonadgs(–î–∏–º–∞ –Æ)", "@night.cross(–õ–µ—à–∞)"],
        "13:00-14:00": ["@night.cross(–õ–µ—à–∞)", "@xx_zmary(–ú–∞—à–∞)"],
        "14:00-15:00": ["@po_katyusha(–ö–∞—Ç—è)", "@xx_zmary(–ú–∞—à–∞)"],
        "15:00-16:00": ["@darianokhrinaa(–î–∞—à–∞ –ù)", "@thesleepinglion(–õ–µ–≤–∞)"]
    },
    2: {  # –°—Ä–µ–¥–∞
        #"10:00-11:00": ["@po_katyusha(–ö–∞—Ç—è)", "@i_am_spacey(–ú–∞–∫—Å–∏–º –ö)"],
        #"11:00-12:00": ["@i_am_spacey(–ú–∞–∫—Å–∏–º –ö)", "@febekey(–í–µ—Ä–∞)"],
        #"12:00-13:00": ["@febekey(–í–µ—Ä–∞)", "@kovtpolly(–ü–æ–ª—è –ö)"],
        #"13:00-14:00": ["@kovtpolly(–ü–æ–ª—è –ö)", "@zhivtsov2000(–ú–∞–∫—Å–∏–º –ñ)"],
        #"14:00-15:00": ["@zhivtsov2000(–ú–∞–∫—Å–∏–º –ñ)", "@dasha_korelina(–î–∞—à–∞ –ö)"],
        #"15:00-16:00": ["@dasha_korelina(–î–∞—à–∞ –ö)", "@avepsam(–†–æ–º–∞)"]
    },
    3: {  # –ß–µ—Ç–≤–µ—Ä–≥
        "10:00-11:00": ["@avepsam(–†–æ–º–∞)", "@darybut(–î–∞—à–∞ –ë)"],
        "11:00-12:00": ["@darybut(–î–∞—à–∞ –ë)", "@zhivtsov2000(–ú–∞–∫—Å–∏–º –ñ)"],
        "12:00-13:00": ["@lezidey(–ö–∏—Ä–∏–ª–ª)", "@mrmogo(–ê–Ω–¥—Ä–µ–π)"],
        "13:00-14:00": ["@aaaaalllooooo(–ê–ª–µ–Ω–∞)", "@lads_mart(–õ–∞–¥–∞)"],
        "14:00-15:00": ["@febekey(–í–µ—Ä–∞)", "@avepsam(–†–æ–º–∞)"],
        "15:00-16:00": ["@apelsinn14(–ú–∏—à–∞)", "@polinariaa_d(–ü–æ–ª—è –î)"]
    },
    4: {  # –ü—è—Ç–Ω–∏—Ü–∞
        #"10:00-11:00": ["@apelsinn14(–ú–∏—à–∞)", "@baldejniy_name(–ú–∞–∫—Å –ü)"],
        #"11:00-12:00": ["@baldejniy_name(–ú–∞–∫—Å –ü)", "@ksushasolnyshko(–ö—Å—é)"],
        #"12:00-13:00": ["@ksushasolnyshko(–ö—Å—é)", "@darianokhrinaa(–î–∞—à–∞ –ù)"],
        #"13:00-14:00": ["@aaaaalllooooo(–ê–ª–µ–Ω–∞)", "@roggi7(–ò–≥–æ—Ä—å)"],
        #"14:00-15:00": ["@roggi7(–ò–≥–æ—Ä—å)", "@polinariaa_d(–ü–æ–ª—è –î)"],
        #"15:00-16:00": ["@polinariaa_d(–ü–æ–ª—è –î)", "@elmsberry(–≠–º–º–∞)"]
    }
}

# –ì—Ä–∞—Ñ–∏–∫ —Ä–∞–±–æ—Ç—ã –∫–æ–≤–æ—Ä–∫–∏–Ω–≥–∞
coworking_schedule = {
    "15-04-2024": {"status": "–ó–∞–∫—Ä—ã—Ç –≤–µ—Å—å –¥–µ–Ω—å"}, # –ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫
    "16-04-2024": {"status": "–û—Ç–∫—Ä—ã—Ç –≤–µ—Å—å –¥–µ–Ω—å"}, # –í—Ç–æ—Ä–Ω–∏–∫
    "17-04-2024": {"status": "–ó–∞–∫—Ä—ã—Ç –≤–µ—Å—å –¥–µ–Ω—å"}, # –°—Ä–µ–¥–∞
    "18-04-2024": {"status": "–û—Ç–∫—Ä—ã—Ç –≤–µ—Å—å –¥–µ–Ω—å"}, # –ß–µ—Ç–≤–µ—Ä–≥
    "19-04-2024": {"status": "–ó–∞–∫—Ä—ã—Ç –≤–µ—Å—å –¥–µ–Ω—å"}  # –ü—è—Ç–Ω–∏—Ü–∞

}

# –ì—Ä–∞—Ñ–∏–∫ —É–±–æ—Ä–∫–∏
cleaning_schedule = {
    "12-02-2024": ["@mrmogo(–ê–Ω–¥—Ä–µ–π)", "@zhivtsov2000(–ú–∞–∫—Å–∏–º –ñ)"],
    "19-02-2024": ["@roggi7(–ò–≥–æ—Ä—å)", "@apelsinn14(–ú–∏—à–∞)"],
    "26-02-2024": ["@avepsam(–†–æ–º–∞)", "@baldejniy_name(–ú–∞–∫—Å –ü)"],
    "4-03-2024": ["@emma_shifter(–ù–∞—Å—Ç—è)", "@ksushasolnyshko(–ö—Å—é)"],
    "11-03-2024": ["@elmsberry(–≠–º–º–∞)", "@limonadgs(–î–∏–º–∞ –Æ)"],
    "18-03-2024": ["@xx_zmary(–ú–∞—à–∞)", "@darianokhrinaa(–î–∞—à–∞ –ù)"],
    "25-03-2024": ["@po_katyusha(–ö–∞—Ç—è)", "@aaaaalllooooo(–ê–ª–µ–Ω–∞)"],
    "1-04-2024": ["@lezidey(–ö–∏—Ä–∏–ª–ª)", "@graziazz(–î–∞—à–∞ –§)"],
    "8-04-2024": ["@kovtpolly(–ü–æ–ª—è –ö)", "@darybut(–î–∞—à–∞ –ë)"],
    "15-04-2024": ["@polinariaa_d(–ü–æ–ª—è –î)", "@i_am_spacey(–ú–∞–∫—Å–∏–º –ö)"]
}



# –°–ª–æ–≤–∞—Ä—å –¥–ª—è —Ä—É—Å—Å–∫–∏—Ö –Ω–∞–∑–≤–∞–Ω–∏–π –¥–Ω–µ–π –Ω–µ–¥–µ–ª–∏
russian_weekdays = {
    0: "–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫",
    1: "–í—Ç–æ—Ä–Ω–∏–∫",
    2: "–°—Ä–µ–¥–∞",
    3: "–ß–µ—Ç–≤–µ—Ä–≥",
    4: "–ü—è—Ç–Ω–∏—Ü–∞",
    5: "–°—É–±–±–æ—Ç–∞",
    6: "–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ"
}

# –û–ø—Ä–µ–¥–µ–ª—è–µ–º –¥–µ–Ω—å –Ω–µ–¥–µ–ª–∏ –¥–ª—è –∑–∞–≤—Ç—Ä–∞—à–Ω–µ–π –¥–∞—Ç—ã
tomorrow = datetime.datetime.now() + datetime.timedelta(days=1)
# –û–ø—Ä–µ–¥–µ–ª—è–µ–º –≤—Ä–µ–º—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è



# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∑–∞ —É–±–æ—Ä–∫—É –Ω–∞ –∑–∞–¥–∞–Ω–Ω—É—é –¥–∞—Ç—É
def get_cleaning_responsibles(date):
    for key_date in cleaning_schedule:
        start_date = datetime.datetime.strptime(key_date, "%d-%m-%Y")
        end_date = start_date + datetime.timedelta(days=6)  # –ü—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —É–±–æ—Ä–∫–∏ - 7 –¥–Ω–µ–π
        if start_date <= date <= end_date:
            return cleaning_schedule[key_date]
    return "–ù–µ —É–∫–∞–∑–∞–Ω–æ"  # –ï—Å–ª–∏ –Ω–∞ –∑–∞–¥–∞–Ω–Ω—É—é –¥–∞—Ç—É –Ω–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —É–±–æ—Ä–∫–µ


while True:
    now = datetime.datetime.now()

    # –û–ø—Ä–µ–¥–µ–ª—è–µ–º –¥–µ–Ω—å –Ω–µ–¥–µ–ª–∏ –¥–ª—è –∑–∞–≤—Ç—Ä–∞—à–Ω–µ–π –¥–∞—Ç—ã
    tomorrow = datetime.datetime.now() + datetime.timedelta(days=1)
    tomorrow_day = tomorrow.weekday()

    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–æ –ª–∏ –Ω—É–∂–Ω–æ–µ –≤—Ä–µ–º—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è
    if datetime.time(21, 11) < now.time() and now.time() < datetime.time(21, 12):
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Å–µ–≥–æ–¥–Ω—è –Ω–µ —Å—É–±–±–æ—Ç–∞ –∏–ª–∏ –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ
        if tomorrow_day not in [5, 6]:
            message = f"–î–∞—Ç–∞: {tomorrow.strftime('%d-%m-%Y')}\n"
            message += f"–î–µ–Ω—å –Ω–µ–¥–µ–ª–∏: {russian_weekdays[tomorrow_day]}\n"
            if tomorrow.strftime('%d-%m-%Y') in coworking_schedule:
                coworking_info = coworking_schedule[tomorrow.strftime('%d-%m-%Y')]
                if 'status' in coworking_info:
                    message += f"–°–æ—Å—Ç–æ—è–Ω–∏–µ –∫–æ–≤–æ—Ä–∫–∏–Ω–≥–∞: {coworking_info['status']}\n\n"
                else:
                    message += "–°–æ—Å—Ç–æ—è–Ω–∏–µ –∫–æ–≤–æ—Ä–∫–∏–Ω–≥–∞: –ù–µ —É–∫–∞–∑–∞–Ω–æ\n"
                if 'time' in coworking_info:
                    message += f"–í—Ä–µ–º—è –∫–æ–≤–æ—Ä–∫–∏–Ω–≥–∞: {coworking_info['time']}\n"
            else:
                message += "–°–æ—Å—Ç–æ—è–Ω–∏–µ –∫–æ–≤–æ—Ä–∫–∏–Ω–≥–∞: –ù–µ —É–∫–∞–∑–∞–Ω–æ\n"

            # –ï—Å–ª–∏ –∫–æ–≤–æ—Ä–∫–∏–Ω–≥ –∑–∞–∫—Ä—ã—Ç –≤–µ—Å—å –¥–µ–Ω—å, –≤—ã–≤–æ–¥–∏–º —Ç–æ–ª—å–∫–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ª—é–¥—è—Ö –ø–æ —É–±–æ—Ä–∫–µ
            if tomorrow.strftime('%d-%m-%Y') in coworking_schedule and \
                    coworking_schedule[tomorrow.strftime('%d-%m-%Y')]["status"] == "–ó–∞–∫—Ä—ã—Ç –≤–µ—Å—å –¥–µ–Ω—å":
                message += f"\nüßπ –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–µ –∑–∞ —É–±–æ—Ä–∫—É –Ω–∞ —ç—Ç—É –Ω–µ–¥–µ–ª—é: {', '.join(get_cleaning_responsibles(tomorrow))}\n"
            else:
                if tomorrow_day in duty_schedule:
                    duty_info = duty_schedule[tomorrow_day]
                    message += "–î–µ–∂—É—Ä–Ω—ã–µ –Ω–∞ –∑–∞–≤—Ç—Ä–∞:\n"
                    for time_slot, people in duty_info.items():
                        message += f"{time_slot}: {', '.join(people)}\n"
                else:
                    message += "–î–µ–∂—É—Ä–Ω—ã–µ –Ω–∞ –∑–∞–≤—Ç—Ä–∞: –ù–µ —É–∫–∞–∑–∞–Ω–æ\n"

                # –ü–æ–ª—É—á–∞–µ–º –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∑–∞ —É–±–æ—Ä–∫—É –Ω–∞ –∑–∞–¥–∞–Ω–Ω—É—é –¥–∞—Ç—É –∏ –¥–æ–±–∞–≤–ª—è–µ–º –∏—Ö –≤ —Å–æ–æ–±—â–µ–Ω–∏–µ
                cleaning_responsibles = get_cleaning_responsibles(tomorrow)
                message += f"\nüßπ –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–µ –∑–∞ —É–±–æ—Ä–∫—É –Ω–∞ —ç—Ç—É –Ω–µ–¥–µ–ª—é: {', '.join(cleaning_responsibles)}\n"

            # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –∫–∞–∂–¥—ã–π —á–∞—Ç
            for chat_id in range(1, 3):  # –ü—Ä–µ–¥–ø–æ–ª–æ–∂–∏–º, —á—Ç–æ —É –≤–∞—Å –µ—Å—Ç—å 100 —á–∞—Ç–æ–≤ —Å –Ω–æ–º–µ—Ä–∞–º–∏ –æ—Ç 1 –¥–æ 100
                try:
                    vk.messages.send(chat_id=chat_id, message=message, random_id=0)
                except vk_api.exceptions.ApiError as e:
                    print(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —á–∞—Ç {chat_id}: {e}")
                time.sleep(1)  # –û–∂–∏–¥–∞–Ω–∏–µ –º–µ–∂–¥—É –æ—Ç–ø—Ä–∞–≤–∫–æ–π —Å–æ–æ–±—â–µ–Ω–∏–π, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏

        # –ü–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –∂–¥–µ–º –¥–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ –¥–Ω—è –¥–ª—è –ø–æ–≤—Ç–æ—Ä–∞ —Ü–∏–∫–ª–∞
        time.sleep(60)  # –û–∂–∏–¥–∞–Ω–∏–µ, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ –æ–¥–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
    else:
        # –ï—Å–ª–∏ –≤—Ä–µ–º—è –µ—â–µ –Ω–µ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–æ, –∂–¥–µ–º –Ω–µ–∫–æ—Ç–æ—Ä–æ–µ –≤—Ä–µ–º—è –∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º —Å–Ω–æ–≤–∞
        time.sleep(60)
